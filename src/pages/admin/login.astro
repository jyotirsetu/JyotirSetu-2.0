---
// Admin Login Page
export const prerender = false;

// Check if user is already logged in
if (Astro.cookies.has('admin-session')) {
  return Astro.redirect('/admin/dashboard');
}
---

<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="JyotirSetu Admin Login" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>Admin Login - JyotirSetu</title>
    
    <!-- Tailwind CSS -->
    
    <!-- Reset all styles to prevent conflicts -->
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      html, body {
        height: 100%;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }
      
      .login-container {
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: 
          linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%),
          radial-gradient(circle at 25% 25%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
          radial-gradient(circle at 75% 75%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
          radial-gradient(circle at 50% 50%, rgba(16, 185, 129, 0.1) 0%, transparent 70%);
        position: relative;
      }
      
      .login-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
          radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.2) 0%, transparent 50%),
          radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.2) 0%, transparent 50%),
          radial-gradient(circle at 40% 40%, rgba(16, 185, 129, 0.15) 0%, transparent 50%),
          radial-gradient(circle at 60% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
        pointer-events: none;
        z-index: 0;
        animation: backgroundFloat 20s ease-in-out infinite;
      }
      
      @keyframes backgroundFloat {
        0%, 100% {
          transform: translateY(0px) rotate(0deg);
        }
        33% {
          transform: translateY(-10px) rotate(1deg);
        }
        66% {
          transform: translateY(5px) rotate(-1deg);
        }
      }
      
      .login-card {
        background: rgba(30, 41, 59, 0.8);
        backdrop-filter: blur(15px);
        border-radius: 1rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 4px 16px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(59, 130, 246, 0.2);
        padding: 2rem;
        width: 100%;
        max-width: 400px;
        position: relative;
        z-index: 1;
      }
      
      .login-card:hover {
        background: rgba(30, 41, 59, 0.9);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4), 0 8px 20px rgba(59, 130, 246, 0.2);
        border-color: rgba(59, 130, 246, 0.4);
      }
      
      .login-input {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid rgba(59, 130, 246, 0.3);
        border-radius: 0.5rem;
        background: rgba(15, 23, 42, 0.8);
        color: #f8fafc;
        font-size: 0.875rem;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
      }
      
      .login-input:focus {
        outline: none;
        border-color: rgba(59, 130, 246, 0.6);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        background: rgba(15, 23, 42, 0.9);
      }
      
      .login-input::placeholder {
        color: #94a3b8;
      }
      
      .login-btn {
        width: 100%;
        padding: 0.75rem 1.5rem;
        background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
        color: white;
        border: none;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3);
      }
      
      .login-btn:hover {
        background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
        transform: translateY(-1px);
        box-shadow: 0 6px 8px -1px rgba(59, 130, 246, 0.4);
      }
      
      .login-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }
      
      .error-message {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: #fca5a5;
        padding: 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        margin-bottom: 1rem;
      }
      
      .success-message {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.3);
        color: #6ee7b7;
        padding: 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body class="h-full">
    <div class="login-container">
      <div class="login-card">
        <!-- Logo and Title -->
        <div style="text-align: center; margin-bottom: 2rem;">
          <div style="display: flex; align-items: center; justify-content: center; gap: 0.75rem; margin-bottom: 1rem;">
            <img src="/JyotirSetu Full Logo Transparent.png" alt="JyotirSetu" style="width: 2.5rem; height: 2.5rem;" />
            <h1 style="color: #f8fafc; font-size: 1.5rem; font-weight: bold; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);">Admin Panel</h1>
          </div>
          <p style="color: #cbd5e1; font-size: 0.875rem;">Sign in to access the admin dashboard</p>
        </div>
        
        <!-- Login Form -->
        <form id="loginForm" style="display: flex; flex-direction: column; gap: 1rem;">
          <div>
            <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #cbd5e1; margin-bottom: 0.5rem;">Username</label>
            <input 
              type="text" 
              id="username" 
              name="username" 
              class="login-input" 
              placeholder="Enter your username"
              required
            />
          </div>
          
          <div>
            <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #cbd5e1; margin-bottom: 0.5rem;">Password</label>
            <input 
              type="password" 
              id="password" 
              name="password" 
              class="login-input" 
              placeholder="Enter your password"
              required
            />
          </div>
          
          <div id="messageContainer"></div>
          
          <button type="submit" class="login-btn" id="loginBtn">
            Sign In
          </button>
        </form>
        
        <!-- Links -->
        <div style="text-align: center; margin-top: 1.5rem; display: flex; flex-direction: column; gap: 0.75rem;">
          <a href="/admin/forgot-password" style="color: #60a5fa; font-size: 0.875rem; text-decoration: none; transition: color 0.3s ease;" onmouseover="this.style.color='#93c5fd'" onmouseout="this.style.color='#60a5fa'">
            Forgot Password?
          </a>
          <a href="/" style="color: #cbd5e1; font-size: 0.875rem; text-decoration: none; transition: color 0.3s ease;" onmouseover="this.style.color='#f8fafc'" onmouseout="this.style.color='#cbd5e1'">
            ‚Üê Back to Website
          </a>
        </div>
      </div>
    </div>
    
    <!-- Login Script -->
    <script>
      const loginForm = document.getElementById('loginForm');
      if (loginForm) {
        loginForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const usernameInput = document.getElementById('username') as HTMLInputElement;
          const passwordInput = document.getElementById('password') as HTMLInputElement;
          const loginBtn = document.getElementById('loginBtn') as HTMLButtonElement;
          const messageContainer = document.getElementById('messageContainer') as HTMLElement;
          
          // Check if all elements exist
          if (!usernameInput || !passwordInput || !loginBtn || !messageContainer) {
            console.error('Required form elements not found');
            return;
          }
          
          const username = usernameInput.value;
          const password = passwordInput.value;
          
          // Show loading state
          loginBtn.disabled = true;
          loginBtn.textContent = 'Signing In...';
          messageContainer.innerHTML = '';
          
          try {
            const response = await fetch('/admin/api/login', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ username, password }),
            });
            
            const data = await response.json();
            
            if (data.success) {
              // Show success message
              messageContainer.innerHTML = `
                <div class="success-message">
                  Login successful! Redirecting...
                </div>
              `;
              
              // Redirect to dashboard
              setTimeout(() => {
                window.location.href = '/admin/dashboard';
              }, 1000);
            } else {
              // Show error message
              messageContainer.innerHTML = `
                <div class="error-message">
                  ${data.message || 'Invalid username or password'}
                </div>
              `;
            }
          } catch (error) { // eslint-disable-line @typescript-eslint/no-unused-vars
            messageContainer.innerHTML = `
              <div class="error-message">
                An error occurred. Please try again.
              </div>
            `;
          } finally {
            // Reset button state
            loginBtn.disabled = false;
            loginBtn.textContent = 'Sign In';
          }
        });
      }
    </script>
  </body>
</html>
