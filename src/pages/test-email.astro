---
import Layout from '~/layouts/PageLayout.astro';
---

<Layout>
  <div class="min-h-screen bg-gray-50 py-12">
    <div class="max-w-md mx-auto bg-white rounded-lg shadow-md p-6">
      <h1 class="text-2xl font-bold text-center mb-6">Test Email Functionality</h1>
      
      <div class="space-y-4">
        <p class="text-gray-600 text-center">
          Click the button below to send a test confirmation email to <strong>akansh.pcj@gmail.com</strong>
        </p>
        
        <button 
          id="testEmailBtn" 
          class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors font-medium"
        >
          üß™ Send Test Email
        </button>
        
        <div id="result" class="hidden p-4 rounded-lg"></div>
      </div>
    </div>
  </div>
</Layout>

<script>
  const testEmailBtn = document.getElementById('testEmailBtn');
  const resultDiv = document.getElementById('result');
  
  if (testEmailBtn && resultDiv) {
    testEmailBtn.addEventListener('click', async function() {
      const button = testEmailBtn as HTMLButtonElement;
      
      // Show loading state
      button.disabled = true;
      button.textContent = '‚è≥ Sending...';
      resultDiv.className = 'hidden';
      
      try {
        const response = await fetch('/api/test-email', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          }
        });
        
        const data = await response.json();
        
        if (data.success) {
          resultDiv.className = 'p-4 rounded-lg bg-green-100 text-green-800 border border-green-200';
          resultDiv.innerHTML = `
            <div class="flex items-center">
              <span class="text-green-600 mr-2">‚úÖ</span>
              <span>${data.message}</span>
            </div>
          `;
        } else {
          resultDiv.className = 'p-4 rounded-lg bg-red-100 text-red-800 border border-red-200';
          resultDiv.innerHTML = `
            <div class="flex items-center">
              <span class="text-red-600 mr-2">‚ùå</span>
              <span>${data.message}</span>
            </div>
          `;
        }
      } catch (error) {
        resultDiv.className = 'p-4 rounded-lg bg-red-100 text-red-800 border border-red-200';
        resultDiv.innerHTML = `
          <div class="flex items-center">
            <span class="text-red-600 mr-2">‚ùå</span>
            <span>Error: ${error instanceof Error ? error.message : 'Unknown error'}</span>
          </div>
        `;
      } finally {
        // Reset button
        button.disabled = false;
        button.textContent = 'üß™ Send Test Email';
      }
    });
  }
</script>
