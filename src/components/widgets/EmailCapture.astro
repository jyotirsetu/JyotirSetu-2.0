---
---

<div class="bg-gray-100 p-8 rounded-xl my-8 text-center">
  <h3 class="text-2xl font-bold text-gray-900 mb-4">🌟 Get Your Daily Astro Tip</h3>
  <p class="text-gray-600 mb-6">
    Discover cosmic insights delivered to your inbox daily! Plus, receive your FREE Dosha Balancing Guide!
  </p>

  <form 
    id="emailCaptureForm"
    action="https://formspree.io/f/xnnbgerl" 
    method="POST" 
    class="max-w-md mx-auto"
  >
    <!-- Name Input -->
    <input 
      type="text" 
      name="name" 
      placeholder="Your Name" 
      required 
      class="w-full p-3 mb-4 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 bg-white focus:ring-2 focus:ring-purple-400 focus:outline-none"
    />

    <!-- Email Input -->
    <input 
      type="email" 
      name="email" 
      placeholder="Your Email" 
      required 
      class="w-full p-3 mb-4 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 bg-white focus:ring-2 focus:ring-purple-400 focus:outline-none"
    />

    <!-- Hidden fields -->
    <input type="hidden" name="source" value="homepage_email_capture" />
    <input type="hidden" name="type" value="daily_astro_tip" />

    <!-- Submit Button with Spinner -->
    <button 
      type="submit"
      id="submitBtn"
      class="w-full py-3 bg-gradient-to-r from-purple-500 to-blue-500 text-white font-semibold rounded-lg hover:from-purple-600 hover:to-blue-600 transition-colors duration-200 flex justify-center items-center gap-2"
    >
      <span id="btnText">Get Free Guide & Daily Tips</span>
      <svg id="btnSpinner" class="w-5 h-5 animate-spin hidden text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
      </svg>
    </button>

    <p class="text-xs text-gray-500 mt-2">
      We respect your privacy. Unsubscribe at any time.
    </p>

    <!-- Success & Error messages -->
    <p id="formSuccess" class="opacity-0 transition-opacity duration-500 text-green-600 font-semibold mt-4">
      ✅ Thank you! Your email has been submitted.
    </p>
    <p id="formError" class="opacity-0 transition-opacity duration-500 text-red-600 font-semibold mt-4">
      ❌ Oops! Something went wrong. Please try again.
    </p>
  </form>
</div>

<script is:inline>
  const form = document.getElementById('emailCaptureForm');
  const successMsg = document.getElementById('formSuccess');
  const errorMsg = document.getElementById('formError');
  const submitBtn = document.getElementById('submitBtn');
  const btnText = document.getElementById('btnText');
  const btnSpinner = document.getElementById('btnSpinner');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Hide messages
    successMsg.classList.add('opacity-0');
    errorMsg.classList.add('opacity-0');

    // Show spinner
    btnText.textContent = 'Submitting...';
    btnSpinner.classList.remove('hidden');
    submitBtn.disabled = true;

    const formData = new FormData(form);
    const action = form.action;

    try {
      const response = await fetch(action, {
        method: 'POST',
        body: formData,
        headers: { 'Accept': 'application/json' }
      });

      if (response.ok) {
        successMsg.classList.remove('opacity-0');
        form.reset();
      } else {
        errorMsg.classList.remove('opacity-0');
      }
    } catch (error) {
      errorMsg.classList.remove('opacity-0');
      console.error('Form submission error:', error);
    } finally {
      // Reset button
      btnText.textContent = 'Get Free Guide & Daily Tips';
      btnSpinner.classList.add('hidden');
      submitBtn.disabled = false;

      // Fade out messages after 5 seconds
      setTimeout(() => {
        successMsg.classList.add('opacity-0');
        errorMsg.classList.add('opacity-0');
      }, 5000);
    }
  });
</script>
